CREATE DEFINER=`root`@`localhost` TRIGGER `apptradev6`.`tbl_consignor_BEFORE_INSERT` BEFORE INSERT ON `tbl_consignor` FOR EACH ROW
BEGIN
	Declare strconcat varchar(10);
	Declare lpadcount varchar(6);
	Declare intcount int;
	Declare strfinal varchar(20);
    DECLARE var1 int;
    DECLARE var2 int;
    DECLARE var3 int;
    SET var1 := (SELECT RIGHT((SELECT intConsignorID FROM tbl_consignor ORDER BY intConsignorID DESC LIMIT 1), 6));
    SET var2 := (SELECT RIGHT(strfinal, 6));
    SET var3 := NEW.booConsignorType;
    SET intcount := (SELECT smartcounter() + 1);
    Set lpadcount := (SELECT Lpad(intcount, 6 , '0'));
    
    
    
   
    
	IF var2 = var1
    THEN
		SET var2 := var2 + 1;
		SET lpadcount := (SELECT Lpad(var2, 6 , '0'));
    END IF;
    
    IF var3 = '0'
	THEN
		 Set strfinal := (SELECT concat(LEFT(NOW(), 4),"-CON-CP-", lpadcount));
	ELSEIF var3 = '1'
	THEN
		SET strfinal := (SELECT concat(LEFT(NOW(), 4),"-CON-PS-", lpadcount));
	END IF;
    
		
		
    SET NEW.intConsignorID = strfinal;
END