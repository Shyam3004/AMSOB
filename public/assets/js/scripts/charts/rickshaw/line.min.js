Rickshaw.namespace('Rickshaw.Fixtures.RandomData');

Rickshaw.Fixtures.RandomData = function(timeInterval) {

	var addData;
	timeInterval = timeInterval || 1;

	var lastRandomValue = 200;

	var timeBase = Math.floor(new Date().getTime() / 1000);

	this.addData = function(data) {

		var randomValue = Math.random() * 100 + 15 + lastRandomValue;
		var index = data[0].length;

		var counter = 1;

		data.forEach( function(series, index) {
			var randomVariance = Math.random() * 20;
			var v = randomValue / 25  + counter++ +
				(Math.cos((index * counter * 11) / 960) + 2) * 15 +
				(Math.cos(index / 7) + 2) * 7 +
                (Math.cos(index / 17) + 2) * 1;

            if(index == 0){
                $.post('/reports/consignor/count').then(function(data){
                    if(data.indicator){
                        series.push( { x: (index * timeInterval) + timeBase, y: data.consignorCount} );
                    }
                })
            }
            if(index == 1){
                $.post('/reports/bidder/count').then(function(data){
                    if(data.indicator){
                        series.push( { x: (index * timeInterval) + timeBase, y: data.bidderCount} );
                    }
                })
            }
                

		} );

		lastRandomValue = randomValue * 0.85;
	};

	this.removeData = function(data) {
		data.forEach( function(series) {
			series.shift();
		} );
		timeBase += timeInterval;
	};
};



$(window).on("load",function(){
    for(var e=[[],[]],a=new Rickshaw.Fixtures.RandomData(100),n=0;n<100;n++)
        a.addData(e);
    var r=$("#line-chart"),
    i=new Rickshaw.Graph({
        element:r.get(0),
        width:r.width(),
        height:400,
        renderer:"line",
        series:[
            {
                color:"#99B898",
                data:e[0],
                name:"Consignor"
            },
            {
                color:"#6C5B7B",
                data:e[1],
                name:"Bidder"
            }
        ]
    });
    i.render(),
    setInterval(function(){
        a.removeData(e),
        a.addData(e),
        i.update()
    },2e3);
    new Rickshaw.Graph.HoverDetail({
        graph:i
    });
    var o=new Rickshaw.Graph.Legend({
        graph:i,
        element:document.getElementById("line-chart-legend")
    });
    new Rickshaw.Graph.Behavior.Series.Toggle({
        graph:i,
        legend:o
    });
    new Rickshaw.Graph.Axis.Time({
        graph:i
    }).render(),

    $(window).on("resize",function(){
        i.configure({
            width:r.width()
        }),
        i.render()
    })
});